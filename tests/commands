awk -e 'BEGIN {out=0}; /MainLoop()/ {out=1}; out && /^cells searched kept:/ && ! /^cells searched kept:  1 / {print $4 > "cells.txt"; print $5 > "leaf_cells.txt"}' output
sort -n cells.txt > cells_sorted.txt
sort -n leaf_cells.txt > leaf_cells_sorted.txt
awk -e 'BEGIN {sum=0}; {sum++; print $1, sum}' cells_sorted.txt > F.txt
awk -e 'BEGIN {sum=0}; {sum++; print $1, sum}' leaf_cells_sorted.txt > leaf_F.txt

awk -e 'BEGIN {out=0}; /MainLoop()/ {out=1}; out && /^p\+d\+o/ {print $4 > "part.txt"; print $5 > "neib.txt"}; out && /^neiblist/ {print $4 > "culled_neib.txt"}' output
sort -n part.txt > part_sorted.txt
sort -n neib.txt > neib_sorted.txt
sort -n culled_neib.txt > culled_neib_sorted.txt
awk -e 'BEGIN {sum=0}; {sum++; print $1, sum}' part_sorted.txt > part_F.txt
awk -e 'BEGIN {sum=0}; {sum++; print $1, sum}' neib_sorted.txt > neib_F.txt
awk -e 'BEGIN {sum=0}; {sum++; print $1, sum}' culled_neib_sorted.txt > culled_neib_F.txt

awk -e 'BEGIN {out=0}; /MainLoop()/ {out=1}; out && /^Nactive = / {print $3 > "nactive.txt"}' output
sort -n nactive.txt | uniq -c > nactive_frequency.txt

gnuplot

unset logscale x
stats "F.txt" using 2 nooutput
n_F=STATS_max
stats "leaf_F.txt" using 2 nooutput
n_leaf_F=STATS_max
stats "part_F.txt" using 2 nooutput
n_part_F=STATS_max
stats "neib_F.txt" using 2 nooutput
n_neib_F=STATS_max
stats "culled_neib_F.txt" using 2 nooutput
n_culled_neib_F=STATS_max

set logscale x
plot "F.txt" using 1:($2/n_F) with points pt 0
replot "leaf_F.txt" using 1:($2/n_leaf_F) with points pt 0

plot "part_F.txt" using 1:($2/n_part_F) with points pt 0
replot "neib_F.txt" using 1:($2/n_neib_F) with points pt 0
replot "culled_neib_F.txt" using 1:($2/n_culled_neib_F) with points pt 0
